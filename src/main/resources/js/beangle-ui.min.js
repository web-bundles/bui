(function(bg,undefined){function NamedFunction(e,t,n){this.name=e,this.func=t,this.objectCount=null==n?"ge0":n}function ToolBar(divId,title,imageName){if(this.itemCount=0,this.bar=document.getElementById(divId),null!=this.bar){this.bar.innerHTML="",this.id=divId,this.separator="&nbsp;",this.bar.className="toolbar notprint";var imagePath=beangle.staticBase+"bui/"+beangle.version+"/icons/16x16/actions/";this.setTitle=function(e,t){e&&(null==t&&(t="action-info"),this.title_div.innerHTML=genIconElement(null,t)+"<strong>"+e+"</strong>")},this.setSeparator=function(e){this.separator=e},this.init=function(e,t){var n,i,a=document.createElement("div");a.className="toolbar-title",this.bar.appendChild(a),this.title_div=a,this.setTitle(e,t),(i=document.createElement("div")).className="toolbar-items",i.id=this.id+"_items",this.items_div=i,this.bar.appendChild(i),(n=document.createElement("div")).className="toolbar-msg",n.style.display="none",n.id=this.id+"_msg",this.bar.appendChild(n)},this.init(title,imageName),this.addHr=function(){hrdiv=this.appendDiv(null,"toolbar-line"),hrdiv.innerHTML='<img height="1px" width="100%" align="top" src="'+imagePath+'keyline.png" />'},this.addBack=function(e){null==e?this.addItem("返回",(function(){history.back(-1)}),"action-backward"):this.addItem(e,(function(){history.back(-1)}),"action-backward")},this.addHelp=function(e){this.addItem("帮助",(function(){null==e?bg.alert("施工中.."):window.open("help.action?helpId="+e)}),"action-help-contents")},this.addPrint=function(e){null==e?this.addItem("打印","print()"):this.addItem(e,"print()")},this.addClose=function(e){""!=e&&null!=e||(e="关闭"),this.addItem(e,"window.close()","action-close")},this.addItem=function(e,t,n,i,a){this.addSeparatorAsNeed();var r=document.createElement("div");return r.innerHTML=genIconElement(t,n)+e,r.onmouseout=MouseOutItem,r.onmouseover=MouseOverItem,setAction(r,t),a||"object"==typeof t&&(a=t.objectCount),a||(a="ge0"),r.className="toolbar-item toolbar-item-"+a+("ge0"!=a?" toolbar-item-disabled":""),r.title=null==i?e:i,this.items_div.appendChild(r),this.itemCount++,r},this.addDiv=function(e){var t=document.createElement("div");return e&&(t.className=e),this.items_div.appendChild(t),t},this.appendDiv=function(e,t){var n=document.createElement("div");return e&&n.setAttribute("id",e),t&&(n.className=t),document.getElementById(this.id).appendChild(n),n},this.addSeparator=function(){this.separator&&(this.addDiv("toolbar-separator").innerHTML=this.separator)},this.addSeparatorAsNeed=function(){0!=this.itemCount&&this.addSeparator()},this.addBackOrClose=function(e,t){parent.location==self.location&&(window.history.length<=1||null==window.history.length)?this.addClose(null==t?"关闭":t):this.addBack(null==e?"后退":e)},this.addBlankItem=function(){this.addDiv("toolbar-group-separator").innerHTML="&nbsp;",this.itemCount++},this.setMessage=function(e){void 0!==e&&(document.getElementById(this.id+"_msg").innerHTML=e)},this.addMenu=function(e,t,n,i){this.addSeparatorAsNeed();var a=document.createElement("div");a.className="toolbar-item toolbar-item-ge0";var r=this.id+this.itemCount+"_menu";if(a.id=r,a.tabIndex=0,a.title=i||e,a.onmouseout=MouseOutItem,a.onmouseover=MouseOverItem,this.items_div.appendChild(a),null==t)a.innerHTML=genIconElement(null,n)+e+"&nbsp;"+genIconElement(null,"action-downarrow"),a.onclick=function(e){displayMenu(e)};else{var o=document.createElement("span");o.innerHTML=genIconElement(t,n)+e,setAction(o,t);var s=document.createElement("span");s.innerHTML=genIconElement(t,"action-downarrow"),s.onclick=function(e){displayMenu(e)},a.appendChild(o),a.appendChild(s)}a.onblur=function(e){hiddenMenu(e)};var d=new Menu(r,a);return this.itemCount++,d}}function genIconElement(e,t){var n="action-default";if(null!=t){if(t.indexOf(".")>-1)return"/"!=t.charAt(0)&&(t=imagePath+t),'<img class="toolbar-img" src="'+t+'"/>';n=t}return null==t&&null!=e&&("object"==typeof e&&(e=e.name),"string"==typeof e&&(0==e.indexOf("add")||0==e.indexOf("batchAdd")||0==e.indexOf("new")?n="action-new":0==e.indexOf("remove")||0==e.indexOf("delete")?n="action-edit-delete":0==e.indexOf("update")||0==e.indexOf("edit")||0==e.indexOf("batchEdit")?n="action-update":0==e.indexOf("export")?n="action-excel":0==e.indexOf("copy")?n="action-edit-copy":0==e.indexOf("print")?n="action-print":0==e.indexOf("refresh")?n="action-refresh":0==e.indexOf("close")?n="action-close":0==e.indexOf("save")?n="action-save":0==e.indexOf("download")&&(n="action-download"))),'<span class="toolbar-icon '+n+'" ></span>'}function setAction(item,action){null!=action?"function"!=typeof action?("string"==typeof action&&(-1!=action.indexOf("(")?item.onclick=function(){eval(action)}:-1!=action.indexOf(".action")?item.onclick=function(){Go(action)}:bg.alert("unsuported action description:"+action)),"object"!=typeof action||(item.onclick=action.func)):item.onclick=action:bg.alert("action should not be null")}function hiddenMenu(e){for(var t=bg.event.getTarget(e);t&&"div"!=t.tagName.toLowerCase();)t=t.parentNode;var n=t.lastElementChild||t.lastChild;if(null!=n&&"table"==n.tagName.toLowerCase()){if(""!=n.style.display&&"none"!=n.style.display){for(var i=0;i<n.rows.length;i++)if("toolbar-menuitem-transfer"==n.rows[i].cells[0].className)return;n.style.display="none"}}else alert("menu is null then return and target is "+t)}function displayMenu(e){for(var t=bg.event.getTarget(e);t&&"div"!=t.tagName.toLowerCase();)t=t.parentNode;var n=t.lastElementChild||t.lastChild;null!=n?""!=n.style.display&&"none"!=n.style.display?(n.style.display="none",t.className="toolbar-item-transfer"):(n.style.display="block",t.className="toolbar-item-selected"):alert("menu is null then return and target is "+t)}function Menu(e,t){var n=document.createElement("table");n.className="toolbar-menu",n.id=e+"Table";var i=document.createElement("tbody");n.appendChild(i),jQuery("#"+e).find("span").length>0&&(n.onclick=function(e){displayMenu(e)}),t.appendChild(n),this.table=n,this.addItem=function(e,t,n,i){var a=document.createElement("td");a.innerHTML=genIconElement(t,n)+e,a.onmouseout=MouseOutMenuItem,a.onmouseover=MouseOverMenuItem,a.title=i||e,setAction(a,t),a.className="toolbar-menuitem",a.width="100%";var r=document.createElement("tr");r.appendChild(a),0==this.table.tBodies.length&&this.table.appendChild(document.createElement("tbody")),this.table.tBodies[0].appendChild(r)}}function MouseOutMenuItem(e){for(var t=bg.event.getTarget(e);t&&"td"!=t.tagName.toLowerCase();)t=t.parentNode;t&&(t.className="toolbar-menuitem")}function MouseOverMenuItem(e){for(var t=bg.event.getTarget(e);t&&"td"!=t.tagName.toLowerCase();)t=t.parentNode;t&&(t.className="toolbar-menuitem-transfer")}function MouseOverItem(e){for(var t=bg.event.getTarget(e);t&&"div"!=t.tagName.toLowerCase();)t=t.parentNode;t&&jQuery(t).removeClass("toolbar-item").addClass("toolbar-item-transfer")}function MouseOutItem(e){for(var t=bg.event.getTarget(e);t&&"div"!=t.tagName.toLowerCase();)t=t.parentNode;t&&jQuery(t).removeClass("toolbar-item-transfer").removeClass("toolbar-item-selected").addClass("toolbar-item")}}function RestUrlRender(){this.names={remove:"?_method=delete",info:"{id}",edit:"{id}/edit"},this.isParamUrl=function(e){return!!this.names[e]&&-1!=this.names[e].indexOf("{")},this.render=function(e,t,n){this.names[t]&&(t=this.names[t]),t.indexOf("{id}")>=0&&(t=t.replace("{id}",n.id));var i=e.lastIndexOf("/"),a=e.lastIndexOf("."),r=e,o="";return-1==i&&(i=a),-1!=i&&(r=e.substring(0,i)),-1!=a&&(o=e.substring(a)),t.length>0?"?"==t.charAt(0)?r+t+o:r+"/"+t+o:r+o}}function StrutsUrlRender(){this.names={new:"edit"},this.isParamUrl=function(e){return!1},this.render=function(e,t,n){this.names[t]&&(t=this.names[t]);var i=e.lastIndexOf("!"),a=e.lastIndexOf("."),r=e,o="";return-1==i&&(i=a),-1!=i&&(r=e.substring(0,i)),-1!=a&&(o=e.substring(a)),r+"!"+t+o}}function EntityAction(e,t){this.entity=e,this.page=t,this.urlRender=new RestUrlRender;var n=this;if(this.renderAs=function(e){"struts"==e?this.urlRender=new StrutsUrlRender:"rest"==e?this.urlRender=new RestUrlRender:alert("Cannot support unknow urlrender "+e)},this.render_url=function(e,t){return this.urlRender.render(this.page.actionurl,e,t)},this.isParamUrl=function(e){return this.urlRender.isParamUrl(e)},this.getForm=function(){return this.page.getForm()},this.addParam=function(e,t){bg.form.addInput(this.getForm(),e,t)},null!=this.page.target&&""!=this.page.target){var i=this.getForm();null!=i&&(i.target=this.page.target)}this.submitIdAction=function(e,t,n,i){null==t&&(t=!1);var a=bg.input.getCheckBoxValues(this.entity+".id");if(null!=a&&""!=a){if(!t&&a.indexOf(",")>0)alert("请仅选择一个");else if(null==n||""==n||confirm(n)){var r=this.getForm();r.action=this.render_url(e,{id:a}),this.isParamUrl(e)||(t?(bg.form.removeInputs(r,this.entity+".id"),bg.form.addInputs(r,this.entity+".id",a.split(","))):bg.form.addInput(r,this.entity+".id",a)),this.page.paramstr&&(bg.form.addHiddens(r,this.page.paramstr),bg.form.addParamsInput(r,this.page.paramstr)),i&&"_blank"==i?bg.form.submit(r,null,i,null,!1):bg.form.submit(r,null,null,null,i)}}else bg.alert(t?"请选择一个或多个进行操作":"请选择一个进行操作")},this.remove=function(e){return e=e||"确认删除?",new NamedFunction("remove",(function(){n.submitIdAction("remove",!0,e)}),bg.ui.grid.enableDynaBar?"ge1":"ge0")},this.add=function(){return new NamedFunction("add",(function(){var e=n.getForm();""!=n.page.paramstr&&bg.form.addHiddens(e,n.page.paramstr),bg.form.addInput(e,n.entity+".id",""),""!=n.page.paramstr&&bg.form.addParamsInput(e,n.page.paramstr),bg.form.submit(e,n.render_url("new"))}))},this.info=function(){return new NamedFunction("info",(function(){n.submitIdAction("info",!1)}),bg.ui.grid.enableDynaBar?"e1":"ge0")},this.edit=function(){return new NamedFunction("edit",(function(){n.submitIdAction("edit",!1)}),bg.ui.grid.enableDynaBar?"e1":"ge0")},this.single=function(e,t,i,a){return new NamedFunction(e,(function(){var r=n.getForm();null!=i&&bg.form.addHiddens(r,i),n.submitIdAction(e,!1,t,a)}),bg.ui.grid.enableDynaBar?"e1":"ge0")},this.multi=function(e,t,i,a){return new NamedFunction(e,(function(){try{var r=n.getForm();null!=i&&bg.form.addHiddens(r,i),n.submitIdAction(e,!0,t,a)}catch(e){bg.alert(e)}}),bg.ui.grid.enableDynaBar?"ge1":"ge0")},this.method=function(e,t,i,a){return new NamedFunction(e,(function(){var r=n.getForm();(null==t||""==t||confirm(t))&&(null!=i&&bg.form.addHiddens(r,i),""!=n.page.paramstr&&(bg.form.addHiddens(r,n.page.paramstr),bg.form.addParamsInput(r,n.page.paramstr)),a&&"_blank"==a?bg.form.submit(r,n.render_url(e),a,null,!1):bg.form.submit(r,n.render_url(e),null,null,a))}))},this.exportData=function(e,t,i){return t=t||"xls",e=e||"",0!=(i=i||"").indexOf("&")&&(i="&"+i),i="&format="+t+"&properties="+e+i,n.method("export",null,i,!1)}}function OnReturn(e){this.form=e,this.elemts=new Array,this.select=!0,this.add=function(e){this.elemts.push(e)},this.focusById=function(e){if(13==e.keyCode)for(var t=getEventTarget(portableEvent(e)).id,n=0;n<this.elemts.length-1;n++)if(t!=this.elemts[n]);else{if(document.getElementById(this.elemts[n+1])&&"hidden"!=document.getElementById(this.elemts[n+1]).type){document.getElementById(this.elemts[n+1]).focus(),"text"==document.getElementById(this.elemts[n+1]).type&&document.getElementById(this.elemts[n+1]).select();break}t=this.elemts[n+1]}},this.focus=function(e){if(13==e.keyCode)for(var t=beangle.event.getTarget(e).name,n=0;n<this.elemts.length-1;n++)if(t!=this.elemts[n]);else{if(this.form[this.elemts[n+1]]&&"hidden"!=this.form[this.elemts[n+1]].type){this.form[this.elemts[n+1]].focus(),"text"==this.form[this.elemts[n+1]].type&&this.form[this.elemts[n+1]].select();break}t=this.elemts[n+1]}}}function TableTree(){this.idComma=".",this.findTreeTable=function(e){for(;e&&"TABLE"!=e.tagName;)e=e.parentNode;return e},this.findTreeColumn=function(e){for(;e&&"TD"!=e.tagName;)e=e.parentNode;for(var t=0;e&&e.previousElementSibling;)t+=1,e=e.previousElementSibling;return t},this.matchStart=function(e,t,n){var i=e.indexOf(t);return 0==i&&(!n||!(e.slice(i+t.length,e.length).indexOf(this.idComma)>=0))},this.countchar=function(e){for(var t=0,n=0;n<e.length;n++)e.charAt(n)==this.idComma&&t++;return t+1},this.toggle=function(e){var t=this.findTreeTable(e).getElementsByTagName("TR"),n=this.findTreeColumn(e);e.className="tree-folder";for(var i="none",a=e.parentNode.parentNode.parentNode.id+this.idComma,r=0;r<t.length;r++){var o=t[r];if(this.matchStart(o.id,a,!0)){"none"==o.style.display&&(i=document.all?"block":"table-row",e.className="tree-folder-open");break}}for(var s="none"!=i,d=0;d<t.length;d++){var l=t[d];if(this.matchStart(l.id,a,s)){l.style.display=i;var u=l.getElementsByTagName("td")[n].getElementsByTagName("div")[0].getElementsByTagName("a")[0];null!=u.getAttribute("onclick")&&(u.className="tree-folder")}}},this.select=function(e,t,n){var i=this.findTreeTable(e).getElementsByTagName("tr"),a=e.parentNode.parentNode.id,r=e.checked;null==n&&(n=!0);for(var o=0;o<i.length;o++){var s=i[o];if(""!=s.id&&(0==s.id.indexOf(a)||0==a.indexOf(s.id))){var d=s.getElementsByTagName("td")[0].getElementsByTagName("input")[0],l=!1;0==a.indexOf(s.id)?(r&&n&&(d.checked=!0),a==s.id&&(l=!0)):(d.checked=r,l=!0),l&&t&&t(d)}}},this.selectAll=function(e,t){for(var n=this.findTreeTable(e).getElementsByTagName("tr"),i=(e.parentNode.parentNode.id,e.checked),a=0;a<n.length;a++){var r=n[a];if(r.id){var o=r.getElementsByTagName("td")[0];if(1==o.getElementsByTagName("input").length){var s=o.getElementsByTagName("input")[0];s.checked=i,t&&t(s)}}}},this.collapseAllRows=function(e){for(var t=document.getElementById(e).getElementsByTagName("tr"),n=0;n<t.length;n++){var i=t[n];i.id.indexOf(this.idComma)>1&&(i.style.display="none")}},this.collapseAllRowsFor=function(e,t){for(var n=document.getElementById(e).getElementsByTagName("tr"),i=0;i<n.length;i++){var a=n[i];if(this.countchar(a.id)>t&&(a.style.display="none"),this.countchar(a.id)>=t){var r=document.getElementById(a.id+"_folder");r&&(r.className="tree-folder")}}},this.displayAllRowsFor=function(e,t){for(var n=document.getElementById(e).getElementsByTagName("tr"),i=0;i<n.length;i++){var a=n[i];if(this.countchar(a.id)>t&&(a.style.display=""),this.countchar(a.id)>=t){var r=document.getElementById(a.id+"_folder");r&&(r.className="tree-folder-open")}}}}bg.alert=function(e){alert(e)},bg.uitheme="default",bg.extend({"ui.toolbar":function(e,t,n){return new ToolBar(e,t,n)}}),bg.extend({"ui.gridbar":function(e,t){this.divIds=e,this.pageId=null,this.title=t,this.toolbars=[];for(var n=0;n<e.length;n++)this.toolbars[n]=bg.ui.toolbar(e[n],t),this.toolbars[n].setSeparator(""),document.getElementById(e[n]).className=0==n?"gridbar gridbar-top":"gridbar gridbar-bottom",document.getElementById(e[n]+"_items").className="gridbar-items";function i(e,t,n,i,a){for(var r=new Array,o=0;o<a.length;o++)r[o]=a[o].addMenu(e,t,n,i);this.addItem=function(e,t,n,i){for(var a=0;a<r.length;a++)r[a].addItem(e,t,n,i)}}this.pageId=function(e){return this.pageId=e,this},this.addItem=function(e,t,n,i){for(var a=0;a<this.toolbars.length;a++)this.toolbars[a].addItem(e,t,n,i)},this.addBack=function(e,t){for(var n=0;n<this.toolbars.length;n++)this.toolbars[n].addBack(e)},this.addBackOrClose=function(){for(var e=0;e<this.toolbars.length;e++)this.toolbars[e].addBackOrClose()},this.addBlankItem=function(e,t,n,i){for(var a=0;a<this.toolbars.length;a++)this.toolbars[a].addBlankItem(e,t,n,i)},this.addPage=function(t,n,i){this.myPage=t;for(var a=0;a<this.toolbars.length;a++)pageDiv=this.toolbars[a].appendDiv(e[a]+"_page","girdbar-pgbar"),bg.ui.pagebar(t,pageDiv,n,i);return this},this.addEntityAction=function(e,t){return bg.entityaction(e,t)},this.addPrint=function(e){for(var t=0;t<this.toolbars.length;t++)this.toolbars[t].addPrint(e)},this.addMenu=function(e,t,n,a){return new i(e,t,n,a,this.toolbars)}}}),bg.extend({"ui.pagebar":function(e,t,n,i){if(0!=e.totalItems){n?0==n.length&&(n=[e.pageSize]):n=[10,20,30,50,70,100,200,500,1e3],i||(i={first:"« First",previous:"‹ Previous",next:"Next ›",last:"Last »",no:"No:",size:"Size:",change:"Click me to change page size",pagesize:"Page Size"});var a=e.totalPages;addAnchor=function(n,i){var a=document.createElement("a");a.setAttribute("href","javascript:void(0)"),a.innerHTML=n,a.style.padding="0px 2px 0px 2px",t.appendChild(a),jQuery(a).click((function(){e.goPage(i)}))},e.pageIndex>1&&(addAnchor(i.first,1),addAnchor(i.previous,e.pageIndex-1));var r=document.createElement("span");r.innerHTML="<strong>"+e.startNo+"</strong> - <strong>"+e.endNo+"</strong> of <strong>"+e.totalItems+"</strong>",r.style.padding="0px 2px 0px 2px",t.appendChild(r);var o=jQuery(r);o.attr("title",i.change),o.mouseover((function(){this.className="pgbar-label"})),o.mouseout((function(){this.className=""})),o.click((function(){this.parentNode.style.marginTop="0px",this.nextSibling.style.display="",this.style.display="none"}));var s=document.createElement("span"),d=null;if(s.style.display="none",n&&n.length>0){(d=document.createElement("select")).id=t.id+"_select",s.appendChild(d),d.className="pgbar-selbox",d.title=i.pagesize||"Page Size";for(var l=0,u=0;u<n.length;u++)n[u]==e.pageSize&&(l=u),d.options.add(new Option(i.size+n[u],n[u]));d.selectedIndex=l}var c=document.createElement("input");c.className="pgbar-input",s.appendChild(c);var m=document.createElement("label");s.appendChild(m),jQuery(m).attr("for",t.id+"_input").text("/"+a+" ").toggleClass("pgbar-input-label");var g=jQuery(c);g.attr("value",e.pageIndex),g.attr("id",t.id+"_input"),g.attr("title",e.startNo+" - "+e.endNo+" of "+e.totalItems),g.focus((function(){this.value=""})),g.blur((function(){this.value||(this.value=e.pageIndex),f()}));var h=document.createElement("input");h.setAttribute("type","button"),h.setAttribute("name","gogo"),h.value="Go",h.className="pgbar-go",s.appendChild(h);var f=function(){var n=document.getElementById(t.id+"_input").value,i=n.indexOf("/"+e.totalPages);-1!=i&&(n=n.substring(0,i)),e.goPage(n,document.getElementById(t.id+"_select").value)};jQuery(h).click((function(){f()})),d&&(d.onchange=function(){document.getElementById(t.id+"_input").value="1",f()}),t.appendChild(s),jQuery(s).keypress((function(e){if(e||(e=window.event),e&&e.keyCode&&13==e.keyCode)return f(),!1})),e.pageIndex<e.totalPages&&(addAnchor(i.next,e.pageIndex+1),addAnchor(i.last,e.totalPages))}}}),bg.extend({"ui.grid":{enableSingleRowSelect:!1,enableDynaBar:!0,enableSelectTip:!0,overSortTableHeader:function(){this.style.color="white",this.style.backgroundColor="green"},outSortTableHeader:function(){this.style.borderColor="",this.style.color="",this.style.backgroundColor=""},mouseOverGrid:function(){if(void 0!==this.className){var e=this.className;selectIndex=e.indexOf("griddata-selected"),-1==selectIndex&&(overIndex=e.indexOf("griddata-over"),-1==overIndex?this.className=e+" griddata-over":this.className=e.substring(0,overIndex))}},setGridMessage:function(e,t){var n=document.getElementById(e+"_bar1_msg"),i=document.getElementById(e+"_bar2_msg");n&&(n.style.display=t?"":"none",n.innerHTML=t||""),i&&(i.style.display=t?"":"none",i.innerHTML=t||"")},toggleAll:function(e){for(var t=bg.event.getTarget(e),n=t;null!=n.tagName&&"table"!=n.tagName.toLowerCase()&&null!=(n=n.parentNode););t.parentNode;if(null!=n){var i=0;jQuery("#"+n.id+" .gridselect").each((function(){var e=jQuery(this).find("input");0!=e.length&&(t.checked?(e.prop("checked",!0),jQuery(this).parent("tr").addClass("griddata-selected"),i++):e.is(":checked")&&(e.prop("checked",!1),jQuery(this).parent("tr").removeClass("griddata-selected")))})),bg.ui.grid.notifyGridbar(n.id,i)}},notifyGridbar:function(e,t){void 0===t&&(t=0,jQuery("#"+e+" .gridselect").each((function(){jQuery(this).find("input").is(":checked")&&(t+=1)})));var n=function(){t>=2?jQuery(this).hasClass("toolbar-item-e1")?jQuery(this).addClass("toolbar-item-disabled"):jQuery(this).removeClass("toolbar-item-disabled"):1==t?jQuery(this).hasClass("toolbar-item-ge2")?jQuery(this).addClass("toolbar-item-disabled"):jQuery(this).removeClass("toolbar-item-disabled"):jQuery(this).hasClass("toolbar-item-ge0")?jQuery(this).removeClass("toolbar-item-disabled"):jQuery(this).addClass("toolbar-item-disabled")};bg.ui.grid.enableDynaBar&&(jQuery("#"+e+"_bar1_items .toolbar-item").each(n),jQuery("#"+e+"_bar2_items .toolbar-item").each(n)),bg.ui.grid.enableSelectTip&&(t>1?bg.ui.grid.setGridMessage(e,"已选 <strong>"+t+"</strong> 条"):bg.ui.grid.setGridMessage(e,""))},toggleRow:function(e){for(var t=bg.event.getTarget(e),n=t;null!=n.tagName&&"table"!=n.tagName.toLowerCase()&&null!=(n=n.parentNode););var i=!0,a=null,r=!1;if(null!=t&&"td"==t.tagName.toLowerCase()){for(a=t.parentNode.firstChild;null==a.tagName||"td"!=a.tagName.toLowerCase();)a=a.nextSibling;for(r=t==a,t=a.firstChild;void 0===t.tagName||"input"!=t.tagName.toLowerCase();)if(null==(t=t.nextSibling))return;t.checked=!t.checked}else"checkbox"==t.type||"radio"==t.type?(a=t.parentNode,r=!0):i=!1;if(null!=t&&null!=a&&null!=n&&i){var o=a.parentNode;if(void 0!==o.className){t.checked?jQuery(o).removeClass("griddata-over").addClass("griddata-selected"):jQuery(o).removeClass("griddata-selected").addClass("griddata-over");var s=0;if("radio"==t.type)t.checked&&(s=1);else{var d=!bg.ui.grid.enableSingleRowSelect||r||e.ctrlKey;jQuery("#"+n.id+" .gridselect").each((function(){jQuery(this).find("input").is(":checked")&&(a==this||d?s++:(jQuery(this).find("input").prop("checked",!1),jQuery(this).parent("tr").removeClass("griddata-selected")))})),d||jQuery("#"+n.id+" .gridselect-top").each((function(){jQuery(this).find("input").prop("checked",!1)}))}bg.ui.grid.notifyGridbar(n.id,s),"function"==typeof t.onchange&&t.onchange()}}},sort:function(e,t){if(null!=e){var n=null;n="gridhead-sortable"==t.className?void 0!==t.asc?t.asc:t.id+" asc":"gridhead-asc"==t.className?void 0!==t.desc?t.desc:t.id.replace(/\,/g," desc,")+" desc":"",e.goPage(1,null,n)}else bg.alert("无法找到元素对应的排序表格！")},init:function(e,t){var n,i,a,r,o,s,d,l,u,c,m,g=document.getElementById(e).tHead;if(g&&0!=g.rows.length){for(i=t.orderby,a=function(){bg.ui.grid.sort(t,this)},o=0;o<g.rows.length;o++)for(s=g.rows[o],r=0;r<s.cells.length;r++)if("gridhead-sortable"==(l=s.cells[r]).className&&null!=l.id){if(l.onclick=a,l.onmouseover=bg.ui.grid.overSortTableHeader,l.onmouseout=bg.ui.grid.outSortTableHeader,l.title="点击按 ["+l.innerHTML+"] 排序",u=l.id.replace(/\,/g," desc,")+" desc",void 0!==l.desc&&(u=l.desc),-1!=i.indexOf(u)){l.className="gridhead-desc",l.innerHTML=l.innerHTML+'<span class="gridhead-icon action-sort-desc"></span>';continue}if(c=l.id+" asc",void 0!==l.asc&&(c=l.asc),i==c){l.className="gridhead-asc",l.innerHTML=l.innerHTML+'<span class="gridhead-icon action-sort-asc"></span>';continue}}if(n=document.getElementById(e+"_data"))for(o=0;o<n.rows.length;o++)m=(m=(d=n.rows[o]).className)?" "+m:"",d.className=o%2==1?"griddata-odd"+m:"griddata-even"+m,d.onclick=bg.ui.grid.toggleRow,d.onmouseover=bg.ui.grid.mouseOverGrid,d.onmouseout=bg.ui.grid.mouseOverGrid}},fillEmpty:function(e,t,n,i){var a,r,o=document.getElementById(e),s=t-n;s>7&&(s=7),a=16*s,0==n&&((r=document.createElement("div")).innerHTML=i||"No result matched your search.",r.style.paddingTop=a/2-16+"px",o.appendChild(r)),o.style.height=a+"px"}}}),bg.extend({entityaction:function(e,t){return new EntityAction(e,t)}}),bg.extend({"ui.module":{moduleClick:function(e){var t=document.getElementById(e);"module collapsed"==t.className?t.className="module expanded":t.className="module collapsed"}}}),bg.extend({"ui.onreturn":function(e){return new OnReturn(e)}}),bg.extend({"ui.tabletree":new TableTree}),"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=beangle.ui:"function"==typeof define&&define.amd&&(window.bui=beangle.ui,define("bui",[],(function(){return beangle.ui})))})(beangle);